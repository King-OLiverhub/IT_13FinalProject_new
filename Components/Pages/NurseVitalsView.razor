@page "/nurse-vitals-view/{vitalSignId}"
@layout Layout.DashboardLayout
@using IT_13FinalProject.Models
@using IT_13FinalProject.Data
@using Microsoft.EntityFrameworkCore

@inject ApplicationDbContext DbContext
@inject NavigationManager Navigation
@inject IJSRuntime JsRuntime

<div class="nv-page">
    <header class="dashboard-header">
        <div>
            <h1 class="dashboard-title">Vital Signs Information</h1>
            <p class="dashboard-subtitle">Patient Vital Signs Record Details</p>
        </div>

        <div class="dashboard-user-info">
            <span class="dashboard-user-email">nurse@gmail.com</span>
            <div class="dashboard-user-avatar">ðŸ‘¤</div>
            <span class="dashboard-user-name">Clinical</span>
        </div>
    </header>

    @if (IsLoading)
    {
        <div style="text-align: center; padding: 2rem;">
            <div>Loading vital signs record...</div>
        </div>
    }
    else if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div style="text-align: center; padding: 2rem;">
            <div style="color: red;">Error: @ErrorMessage</div>
            <button class="nv-back-btn" @onclick="GoBack" style="margin-top: 1rem;">Back</button>
        </div>
    }
    else if (VitalSign != null)
    {
        <section class="nv-form-card">
            <div class="nv-form-header-row">
                <div class="nv-form-title-wrap">
                    <span class="nv-form-icon">ðŸ‘¤</span>
                    <h2 class="nv-form-title">Vital Signs Record</h2>
                </div>
                <div class="nv-form-actions">
                    <button class="nv-back-btn" @onclick="GoBack">Back</button>
                    <button class="nv-edit-btn" @onclick="EditRecord">Edit</button>
                </div>
            </div>

            <div class="nv-patient-info">
                <h3>Patient Information</h3>
                <p><strong>Name:</strong> @(VitalSign.Patient?.FirstName + " " + VitalSign.Patient?.LastName ?? "Unknown")</p>
                <p><strong>Date of Visit:</strong> @VitalSign.RecordedDate.ToString("MM/dd/yyyy")</p>
            </div>

            <div class="nv-form-grid">
                <div class="nv-form-column">
                    <h3 class="nv-column-title">Vital Signs</h3>
                    
                    <div class="nv-field-display">
                        <span class="nv-label">Chief Complaint:</span>
                        <span class="nv-value">@(VitalSign.ChiefComplaint ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Blood Pressure:</span>
                        <span class="nv-value">@(VitalSign.BloodPressure ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Heart Rate:</span>
                        <span class="nv-value">@(VitalSign.HeartRate?.ToString() ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Temperature:</span>
                        <span class="nv-value">@(VitalSign.Temperature?.ToString() ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Weight:</span>
                        <span class="nv-value">@(VitalSign.Weight?.ToString() ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Height:</span>
                        <span class="nv-value">@(VitalSign.Height?.ToString() ?? "N/A")</span>
                    </div>
                </div>

                <div class="nv-form-column">
                    <h3 class="nv-column-title">Medical History</h3>

                    <div class="nv-field-display">
                        <span class="nv-label">Allergies:</span>
                        <span class="nv-value">@(VitalSign.Allergies ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Past Illnesses:</span>
                        <span class="nv-value">@(VitalSign.PastIllnesses ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Current Medications:</span>
                        <span class="nv-value">@(VitalSign.CurrentMedications ?? "N/A")</span>
                    </div>

                    <div class="nv-field-display">
                        <span class="nv-label">Family History:</span>
                        <span class="nv-value">@(VitalSign.FamilyHistory ?? "N/A")</span>
                    </div>
                </div>
            </div>

            <div class="nv-notes-section">
                <h3>Additional Information</h3>
                
                <div class="nv-field-display">
                    <span class="nv-label">Doctor Assisted:</span>
                    <span class="nv-value">@(VitalSign.DoctorAssisted ?? "N/A")</span>
                </div>

                <div class="nv-field-display">
                    <span class="nv-label">Nurse Name:</span>
                    <span class="nv-value">@(VitalSign.NurseName ?? "N/A")</span>
                </div>

                <div class="nv-field-display">
                    <span class="nv-label">Department:</span>
                    <span class="nv-value">@(VitalSign.Department ?? "N/A")</span>
                </div>

                <div class="nv-field-display">
                    <span class="nv-label">Type of Visit:</span>
                    <span class="nv-value">@(VitalSign.TypeOfVisit ?? "N/A")</span>
                </div>

                <div class="nv-field-display">
                    <span class="nv-label">Duration of Symptoms:</span>
                    <span class="nv-value">@(VitalSign.DurationSymptoms ?? "N/A")</span>
                </div>

                <div class="nv-field-display">
                    <span class="nv-label">Remarks:</span>
                    <span class="nv-value">@(VitalSign.Remarks ?? "N/A")</span>
                </div>
            </div>
        </section>
    }
</div>

@code {
    [Parameter]
    public string VitalSignId { get; set; } = "";

    private VitalSign? VitalSign;
    private bool IsLoading = true;
    private string ErrorMessage = "";

    protected override async Task OnInitializedAsync()
    {
        await LoadVitalSign();
    }

    private async Task LoadVitalSign()
    {
        try
        {
            IsLoading = true;
            ErrorMessage = "";
            StateHasChanged();

            if (int.TryParse(VitalSignId, out int id))
            {
                VitalSign = await DbContext.VitalSigns
                    .Include(vs => vs.Patient)
                    .FirstOrDefaultAsync(vs => vs.VitalSignId == id);
            }
            else
            {
                ErrorMessage = "Invalid vital sign ID";
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading vital sign: {ex.Message}");
            ErrorMessage = $"Error loading vital sign: {ex.Message}";
        }
        finally
        {
            IsLoading = false;
            StateHasChanged();
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/nurse-vitals-list");
    }

    private void EditRecord()
    {
        Navigation.NavigateTo($"/nurse-vitals-edit/{VitalSignId}");
    }
}
